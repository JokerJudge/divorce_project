{% extends 'divorce/base.html' %}
{% load static %}

{% block content %}
        <div class="container">
            <div class="row">
                <div class="col text-center">
                    <br/>
                    <h1>Онлайн-сервис: Раздел имущества супругов</h1>
                    <br/>
                </div>
            </div>
        </div>

        <br/>

        <section class="container">
            <div class="row justify-content-start">
                <div class="col-12 text-center">
                    <h4>Добавьте сведения о супругах, имуществе и сведения о браке</h4>
                </div>
            </div>
        </section>

        <br/>

        <section class="container">
            <div class="row justify-content-center">
                <div class="col-lg-3 col-md-6 col-sm-12">
                    <div class="card mb-3">
                        <div class="card-body text-center">
                            <h3 class="text-center">Физ. лица
                            <button type="button" class="btn btn-outline-primary btn-sm m-1 float-right" id="myButton">
                                <i class="fa fa-user-plus" aria-hidden="true"></i>
                            </button>
                            <script type="text/javascript">
                                document.getElementById("myButton").onclick = function () {
                                    location.href = "{% url 'form_add_fiz_l' %}";
                                };
                            </script>
                            </h3>
                            <hr/>

                        <!-- url 'add_person' в action
                            <form action="" method="post" autocomplete="off">
                                {% csrf_token %}
                                <div class="input-group">
                                    <input type="text" class="form-control" name="name">
                                    <div class="input-group-append text-info">
                                        <span class="input-group-text bg-white py-0">
                                            <button type="submit" class="btn btn-outline-primary btn-sm">
                                                <i class="fa fa-user-plus" aria-hidden="true"></i>
                                            </button>
                                        </span>
                                    </div>
                                </div>

                            </form>

                            -->

                            <br/>

                            <ul class="list-group text-left">
                                {% for fiz_l in fiz_l_list %}
                                <li class="list-group-item">{{ fiz_l.name }} - {{ fiz_l.date_of_birth }} ({{ fiz_l.sex }})

                                    <form action="{% url 'delete_person' fiz_l.id %}" method="post" class="float-right d-inline">
                                        {% csrf_token %}
                                        <button type="submit" class="close text-danger" aria-label="Close"><span aria-hidden="false">&times;</span></button>
                                    </form>
                                    <a href="{% url 'person_update' fiz_l.id %}" class="btn text-secondary float-right">
                                        <i class="fas fa-user-edit"></i>
                                    </a>
                                </li>
                                {% empty %}
                                <li class="list-group-item">
                                    <span class="font-italic">Добавьте хотя бы одно физическое лицо</span>
                                </li>
                                {% endfor %}
                            </ul>

                        </div>
                    </div>
                </div>
                <br/>
                <div class="col-lg-3 col-md-6 col-sm-12">
                    <div class="card mb-3">
                        <div class="card-body text-center">
                            <h3 class="text-center">Брак
                            <button type="button" class="btn btn-outline-primary btn-sm m-1 float-right" id="myButton2">
                                <i class="fa fa-user-plus" aria-hidden="true"></i>
                            </button>
                            <script type="text/javascript">
                                document.getElementById("myButton2").onclick = function () {
                                    location.href = "{% url 'form_add_marriage' %}";
                                };
                            </script>
                            </h3>

                            <hr/>

                            <ul class="list-group text-left">
                                {% for marriage in marriages_list %}
                                <li class="list-group-item">{{ marriage }}.
                                    Зарегистрирован: <span class="badge badge-pill badge-info">{{ marriage.date_of_marriage_registration }}</span>

                                    <form action="{% url 'delete_marriage' marriage.id %}" method="post" class="float-right d-inline">
                                        {% csrf_token %}
                                        <button type="submit" class="close text-danger" aria-label="Close"><span aria-hidden="false">&times;</span></button>
                                    </form>
                                    <a href="{% url 'marriage_update' marriage.id %}" class="btn text-secondary float-right">
                                        <i class="fas fa-pen"></i>
                                    </a>
                                    {% if marriage.date_of_marriage_divorce is None %}
                                    <a href="{% url 'marriage_divorce' marriage.id %}" class="btn btn-outline-danger btn-sm m-1">
                                        Расторгнуть брак
                                    </a>
                                    {% endif %}
                                    {% if marriage.date_of_marriage_divorce %}
                                        Расторгнут: <span class="badge badge-pill badge-danger">{{ marriage.date_of_marriage_divorce }}</span>
                                    {% endif %}


                                </li>
                                {% empty %}
                                <li class="list-group-item">
                                    <span class="font-italic">Вы можете добавить брак</span>
                                </li>
                                {% endfor %}
                            </ul>

                        </div>
                    </div>
                </div>

                <div class="col-lg-6 col-md-6 col-sm-12">
                    <div class="card mb-3">
                        <div class="card-body text-center">
                            <h3 class="text-center">Имущество
                            <button type="button" class="btn btn-outline-primary btn-sm m-1 float-right" id="myButton3">
                                <i class="fa fa-plus-square" aria-hidden="true"></i>
                            </button>
                            <script type="text/javascript">
                                document.getElementById("myButton3").onclick = function () {
                                    location.href = "{% url 'form_add_property_1' %}";
                                };
                            </script>
                            </h3>
                            <hr/>
                            <ul class="list-group text-left">
                            {% for property, value in property_list.items %}
                                {{ counter.set_to_zero }}


                                <div class="card mb-3">
                                    <div class="card-header">
                                        <h5>{{ value|get_item:"name" }}</h5>
                                        <span class="badge badge-pill badge-warning">{{ value|get_item:"type_of_property_form" }}</span>
                                        <span class="badge badge-pill badge-info">{{ value|get_item:"date_of_purchase" }}</span>
                                        <span class="badge badge-pill badge-secondary">{{ value|get_item:"price" }} руб</span>

                                        <form action="{% url 'delete_property' value|get_item:"id" %}" method="post" class="float-right d-inline">
                                            {% csrf_token %}
                                            <button type="submit" class="close text-danger" aria-label="Close"><span aria-hidden="false">&times;</span></button>
                                        </form>
                                        <a href="{% url 'property_update' value|get_item:"id" %}" class="btn text-secondary float-right">
                                            <i class="fas fa-pen"></i>
                                        </a>

                                    </div>
                                    <div class="card-body text-center">
                                        <span class="mb-0 pb-0">Собственники:</span>
                                        <p class="card-text text-left mt-0 pt-0">


                                            {% for i in value|get_item:'quantity_of_owners'|to_range %}
                                                {% if value|get_item:"owners"|get_item:i|get_item:"совместные сособственники" == None %}
                                                    <b>{{ value|get_item:"owners"|get_item:i|get_item:"name" }}:</b>
                                                    {% if value|get_item:"owners"|get_item:i|get_item:"доля" == 1 %}
                                                        - 100% личная собственность
                                                        <br>
                                                    {% elif value|get_item:"owners"|get_item:i|get_item:"доля" != None %}
                                                        - личная доля: {{ value|get_item:"owners"|get_item:i|get_item:"доля" }}
                                                    <br>
                                                    {% endif %}
                                                {% endif %}
                                                {% if value|get_item:"owners"|get_item:i|get_item:"совместные сособственники" != None %}
                                                    {% if counter.counter == 0 %}
                                                        {{ counter.increment }}
                                                        <b>{{ value|get_item:"owners"|get_item:i|get_item:"name" }}</b> и <b>{{ value|get_item:"owners"|get_item:i|get_item:"совместные сособственники" }}</b>
                                                        {% if value|get_item:"owners"|get_item:i|get_item:"совместная доля" == 1 %}
                                                            - 100% совместная собственность
                                                            <br>
                                                        {% else %}
                                                            - совместная доля: {{ value|get_item:"owners"|get_item:i|get_item:"совместная доля" }}
                                                            <br>
                                                        {% endif %}
                                                    {% endif %}
                                                    {% if value|get_item:"owners"|get_item:i|get_item:"доля" != None %}
                                                        <b>{{ value|get_item:"owners"|get_item:i|get_item:"name" }}</b>
                                                        - личная доля: {{ value|get_item:"owners"|get_item:i|get_item:"доля" }}
                                                        <br>
                                                    {% endif %}
                                                {% endif %}
                                            {% endfor %}

                                        </p>

                                    </div>
                                </div>

                            {% empty %}
                            <div class="card">
                            <li class="list-group-item">
                                <span class="font-italic">Вы можете добавить имущество</span>
                            </li>
                            </div>
                            {% endfor %}


                            </ul>
                    </div>
                </div>
            </div>

            <br/>
            <br/>



            </div>
        <br>
        </section>

        <!-- Заготовка -->

        <section>
            <div class="row justify-content-center">
                <div class="col-12 text-center" id="to_scroll">
                    {% for distribution in distribution_list %}
                    <h4>{{ distribution }}
                        <form action="{% url 'delete_distribution' distribution.id %}" method="post" class="float-right d-inline">
                            {% csrf_token %}
                            <button type="submit" class="close text-danger" aria-label="Close"><span aria-hidden="false">&times;</span></button>
                        </form>
                        </h4>
                        <div class="container">
                            <div class="row justify-content-center">
                                <p>
                                    <i>Обратите внимание, что по общему правилу, совместно нажитое имущество делится поплам.
                                    Поэтому Вам необходимо распределить имущество таким образом, чтобы каждому досталось имущества
                                    на сумму, равняющуюся половине стоимости общего совместного имущества. Разница при неравном делении
                                        должна быть компенсирована супругу, которому досталось меньше имущества</i>
                                </p>
                            </div>
                        </div>


                        <div class="container">
                            <div class="row justify-content-center">
                                <div class="col-lg-12 col-md-12 col-sm-12">
                                    <div class="card mb-3">
                                        <div class="container">
                                            <div class="row justify-content-around">
                                                <div class="col-lg-4 col-md-4 col-sm-4">
                                                    <div class="card m-3">
                                                        <div class="card-header">
                                                            <b>{{ distribution_names|get_item:'person_1' }}</b>
                                                            <br>
                                                            личная собственность
                                                            <br>
                                                            <span class="badge badge-pill badge-secondary">{{ money_sum|get_item:"person_1" }} руб</span>
                                                            <br>
                                                            {% if money_sum|get_item:"common" == 0 %}
                                                                {% if money_sum|get_item:"distribute_to_person_1" > 0 %}
                                                                    Вам должны заплатить компенсацию в размере <span class="badge badge-pill badge-success">{{ money_sum|get_item:"distribute_to_person_1" }} руб</span>
                                                                {% elif money_sum|get_item:"distribute_to_person_1" < 0 %}
                                                                    Вы должны заплатить компенсацию супругу в размере <span class="badge badge-pill badge-danger">{{ money_sum|get_item:"distribute_to_person_1_positive" }} руб</span>
                                                                {% else %}
                                                                    Имущество разделено поровну
                                                                {% endif %}
                                                            {% else %}
                                                                {% if money_sum|get_item:"distribute_to_person_1" > 0 %}
                                                                    осталось передать на сумму: <span class="badge badge-pill badge-secondary">{{ money_sum|get_item:"distribute_to_person_1" }} руб</span>
                                                                {% elif money_sum|get_item:"distribute_to_person_1" < 0 %}
                                                                    Вы должны заплатить компенсацию супругу в размере <span class="badge badge-pill badge-danger">{{ money_sum|get_item:"distribute_to_person_1_positive" }} руб</span>
                                                                {% endif %}
                                                            {% endif %}

                                                        </div>
                                                        <div class="card-body text-left">
                                                            <ul>
                                                            {% for property, value in distribution_property.items %}
                                                                {% for i in value|get_item:'quantity_of_owners'|to_range %}
                                                                    {% if value|get_item:"owners"|get_item:i|get_item:"name" == distribution_names|get_item:'person_1'%}
                                                                        {% if value|get_item:"owners"|get_item:i|get_item:"доля" == 1 %}
                                                                            {% if value|get_item:"for_child_accomodation" != None %}
                                                                                <i><small>Увага! Детское</small></i>
                                                                            {% endif %}
                                                                            {% if value|get_item:"after_break_up" != False %}
                                                                                <i><small>Увага! После расставания</small></i>
                                                                            {% endif %}
                                                                            <li>{{ value|get_item:"name" }} <span class="badge badge-pill badge-secondary">{{ value|get_item:"price" }} руб</span></li>
                                                                        {% elif value|get_item:"owners"|get_item:i|get_item:"доля" != None %}
                                                                            {% if value|get_item:"for_child_accomodation" != None %}
                                                                                <i><small>Увага! Детское</small></i>
                                                                            {% endif %}
                                                                            {% if value|get_item:"after_break_up" != False %}
                                                                                <i><small>Увага! После расставания</small></i>
                                                                            {% endif %}
                                                                            <li>{{ value|get_item:"name" }} {{ value|get_item:"owners"|get_item:i|get_item:"доля" }} <span class="badge badge-pill badge-secondary">{{ value|get_item:"owners"|get_item:i|get_item:"личная доля в деньгах" }} руб</span></li>
                                                                        {% endif %}
                                                                    {% endif %}
                                                                {% endfor %}
                                                            {% endfor %}
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-4 col-md-4 col-sm-4">
                                                    <div class="card m-3">
                                                        <div class="card-header">
                                                            <b>{{ distribution_names|get_item:'person_1' }} и {{ distribution_names|get_item:'person_2' }}</b>
                                                            <br>
                                                            список общей собственности
                                                            <br>
                                                            <span class="badge badge-pill badge-secondary">{{ money_sum|get_item:"common" }} руб</span>

                                                        </div>
                                                        <div class="card-body text-left">
                                                            <ul>
                                                            {% for property, value in distribution_property.items %}
                                                                {{ counter.set_to_zero }}

                                                                {% for i in value|get_item:'owners' %}
                                                                    {% if i|get_item:'совместные сособственники' != None %}
                                                                        {% if counter.counter == 0 %}
                                                                            {% if i|get_item:"name" == distribution_names|get_item:'person_1' and i|get_item:"совместные сособственники" == distribution_names|get_item:'person_2' or i|get_item:"name" == distribution_names|get_item:'person_2' and i|get_item:"совместные сособственники" == distribution_names|get_item:'person_1'%}
                                                                                {% if value|get_item:"for_child_accomodation" != None %}
                                                                                    <i><small>Увага! Детское</small></i>
                                                                                    <br>
                                                                                {% endif %}
                                                                                {% if value|get_item:"after_break_up" != False %}
                                                                                    <i><small>Увага! После расставания</small></i>
                                                                                    <br>
                                                                                {% endif %}
                                                                                {% if i|get_item:"совместная доля" == 1 %}
                                                                                    <li>{{ value|get_item:"name" }} <span class="badge badge-pill badge-secondary">{{ value|get_item:"price" }} руб</span></li>
                                                                                {% else %}
                                                                                    <li>{{ value|get_item:"name" }} {{ i|get_item:"совместная доля" }} <span class="badge badge-pill badge-secondary">{{ i|get_item:"совместная доля в деньгах" }} руб</span></li>
                                                                                {% endif %}
                                                                                <!-- обработка варианта, когда имущество было приобретено для ребенка -->
                                                                                {% if value|get_item:"for_child_accomodation" != None %}
                                                                                    {% if value|get_item:"for_child_accomodation" == distribution_names|get_item:'person_1' %}
                                                                                        <a href="{% url 'common_to_person_1' value|get_item:"id"  %}" class="btn text-secondary d-inline-flex">
                                                                                            <i class="fas fa-arrow-circle-left"></i>передать
                                                                                        </a>
                                                                                        <br>
                                                                                    {% endif %}
                                                                                    {% if value|get_item:"for_child_accomodation" == distribution_names|get_item:'person_2' %}
                                                                                        <a href="{% url 'common_to_person_2' value|get_item:"id" %}" class="btn text-secondary d-inline-flex">
                                                                                            передать<i class="fas fa-arrow-circle-right"></i>
                                                                                        </a>
                                                                                        <br>
                                                                                    {% endif %}
                                                                                {% else %}
                                                                                    <!-- обработка варианта, когда имущество было приобретено после фактического прекращения брачных отношений-->
                                                                                    {% if value|get_item:"after_break_up" != False %}
                                                                                        <a href="{% url 'common_to_person_1' value|get_item:"id"  %}" class="btn text-secondary d-inline-flex">
                                                                                        <i class="fas fa-arrow-circle-left"></i>передать
                                                                                        </a>
                                                                                        <a href="{% url 'common_to_person_2' value|get_item:"id" %}" class="btn text-secondary d-inline-flex">
                                                                                            передать<i class="fas fa-arrow-circle-right"></i>
                                                                                        </a>
                                                                                        <a href="{% url 'common_to_private_after_break_up' value|get_item:"id" %}" class="btn text-secondary d-inline-flex">
                                                                                        преобразовать в личную
                                                                                        </a>
                                                                                        <a href="{% url 'property_update' value|get_item:"id" %}" class="btn text-secondary d-inline-flex">
                                                                                        преобразовать в долевую
                                                                                        </a>
                                                                                    {% else %}
                                                                                    <a href="{% url 'common_to_person_1' value|get_item:"id"  %}" class="btn text-secondary d-inline-flex">
                                                                                        <i class="fas fa-arrow-circle-left"></i>передать
                                                                                    </a>
                                                                                    <a href="{% url 'common_to_person_2' value|get_item:"id" %}" class="btn text-secondary d-inline-flex">
                                                                                        передать<i class="fas fa-arrow-circle-right"></i>
                                                                                    </a>
                                                                                    <br>
                                                                                    <a href="{% url 'property_update' value|get_item:"id" %}" class="btn text-secondary d-inline-flex">
                                                                                        преобразовать в долевую
                                                                                    </a>
                                                                                    {% endif %}
                                                                                {% endif %}
                                                                            {% endif %}
                                                                        {% endif %}
                                                                    {% endif %}
                                                                    {{ counter.increment }}
                                                                {% endfor %}
                                                            {% endfor %}
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-4 col-md-4 col-sm-4">
                                                    <div class="card m-3">
                                                        <div class="card-header">
                                                            <b>{{ distribution_names|get_item:'person_2' }}</b>
                                                            <br>
                                                            личная собственность
                                                            <br>
                                                            <span class="badge badge-pill badge-secondary">{{ money_sum|get_item:"person_2" }} руб</span>
                                                            <br>
                                                            {% if money_sum|get_item:"common" == 0 %}
                                                                {% if money_sum|get_item:"distribute_to_person_2" > 0 %}
                                                                    Вам должны заплатить компенсацию в размере <span class="badge badge-pill badge-success">{{ money_sum|get_item:"distribute_to_person_2" }} руб</span>
                                                                {% elif money_sum|get_item:"distribute_to_person_2" < 0 %}
                                                                    Вы должны заплатить компенсацию супругу в размере <span class="badge badge-pill badge-danger">{{ money_sum|get_item:"distribute_to_person_2_positive" }} руб</span>
                                                                {% else %}
                                                                    Имущество разделено поровну
                                                                {% endif %}
                                                            {% else %}
                                                                {% if money_sum|get_item:"distribute_to_person_2" > 0 %}
                                                                    осталось передать на сумму: <span class="badge badge-pill badge-secondary">{{ money_sum|get_item:"distribute_to_person_2" }} руб</span>
                                                                {% elif money_sum|get_item:"distribute_to_person_2" < 0 %}
                                                                    Вы должны заплатить компенсацию супругу в размере <span class="badge badge-pill badge-danger">{{ money_sum|get_item:"distribute_to_person_2_positive" }} руб</span>
                                                                {% endif %}
                                                            {% endif %}
                                                        </div>
                                                        <div class="card-body text-left">
                                                            <ul>
                                                            {% for property, value in distribution_property.items %}
                                                                {% for i in value|get_item:'quantity_of_owners'|to_range %}
                                                                    {% if value|get_item:"owners"|get_item:i|get_item:"name" == distribution_names|get_item:'person_2'%}
                                                                        {% if value|get_item:"owners"|get_item:i|get_item:"доля" == 1 %}
                                                                            {% if value|get_item:"for_child_accomodation" != None %}
                                                                                <i><small>Увага! Детское</small></i>
                                                                            {% endif %}
                                                                            {% if value|get_item:"after_break_up" != False %}
                                                                                <i><small>Увага! После расставания</small></i>
                                                                            {% endif %}
                                                                            <li>{{ value|get_item:"name" }} <span class="badge badge-pill badge-secondary">{{ value|get_item:"price" }} руб</span></li>
                                                                        {% elif value|get_item:"owners"|get_item:i|get_item:"доля" != None %}
                                                                            {% if value|get_item:"for_child_accomodation" != None %}
                                                                                <i><small>Увага! Детское</small></i>
                                                                            {% endif %}
                                                                            {% if value|get_item:"after_break_up" != False %}
                                                                                <i><small>Увага! После расставания</small></i>
                                                                            {% endif %}
                                                                            <li>{{ value|get_item:"name" }} {{ value|get_item:"owners"|get_item:i|get_item:"доля" }} <span class="badge badge-pill badge-secondary">{{ value|get_item:"owners"|get_item:i|get_item:"личная доля в деньгах"}} руб</span></li>
                                                                        {% endif %}
                                                                    {% endif %}
                                                                {% endfor %}
                                                            {% endfor %}
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    <br>
                                    <div class="row justify-content-center">
                                        <div class="card-body text-center pb-3">
                                            <button type="button" class="btn btn-primary btn m-1" id="myButton5">Распределить по-другому</button>
                                                <script type="text/javascript">
                                                    document.getElementById("myButton5").onclick = function () {
                                                    location.href = "{% url 'main' %}";
                                                };
                                                </script>
                                        </div>
                                    </div>
                                    <br>
                                    </div>
                                </div>
                            </div>
                        </div>

                    {% empty %}
                            <div class="row justify-content-center">
                                <div class="card" style="background: rgba(255, 255, 255, 0.3)">
                                    <div class="card-body text-center pb-3">
                                        <button type="button" class="btn btn-primary btn-lg m-1" id="myButton4">Разделить имущество</button>
                                            <script type="text/javascript">
                                                document.getElementById("myButton4").onclick = function () {
                                                location.href = "{% url 'form_add_distribution' %}";
                                            };
                                            </script>
                                    </div>
                                </div>
                            </div>
                        <br>

                    {% endfor %}
                </div>
            </div>

        {% if distribution_list %}
        <script type="text/javascript">
            var objDiv = document.getElementById("to_scroll");
            objDiv.scrollIntoView();
        </script>
        {% endif %}


        </section>

{% endblock content %}